(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-219d5a63"],{3141:function(t,e,a){"use strict";a.r(e);var s=a("8336"),i=a("62ad"),n=a("a523"),l=a("4bd4"),r=a("132d"),o=a("0fd9"),c=a("2fa4"),m=a("8654"),d=(a("7f7f"),function(){var t=this,e=t._self._c;return e(n["a"],{attrs:{fluid:""}},[e(o["a"],{attrs:{justify:"center"}},[e(i["a"],{attrs:{cols:"12",md:"4"}},[e("material-card",{staticClass:"v-card-profile",attrs:{loading:t.loadingSettings,color:"primary"},scopedSlots:t._u([{key:"header",fn:function(){return[e("div",{staticClass:"pa-3"},[e("h4",{staticClass:"title font-weight-light"},[t._v("\n              Mail\n            ")])]),e(c["a"]),t.isBetaCore(t.user)?e(s["a"],{staticClass:"mr-3",attrs:{color:"secondary"},on:{click:t.editSettings}},[e(r["a"],{staticClass:"pr-3"},[t._v("\n              mdi-cog\n            ")]),t._v("Edit Settings\n          ")],1):t._e()]},proxy:!0},{key:"actions",fn:function(){return[e(c["a"]),e(s["a"],{attrs:{color:"primary"},on:{click:t.sendMail}},[t._v("\n            Send Mail\n          ")])]},proxy:!0}])},[!t.loadingSettings&&!t.settings.host||t.message?e("material-notification",{staticClass:"mb-3",attrs:{color:t.message?"success":"error",icon:"mdi-information-outline"}},[t._v("\n          "+t._s(t.message?t.message:"No mail settings have been set for this site. Contact BetaCore to use mail.")+"\n        ")]):t._e(),e(l["a"],{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[t._l(t.emails,(function(a,n){return[e(o["a"],{key:n,staticClass:"mb-2 mx-0",style:"border: 1px solid; border-color: "+t.$vuetify.theme.themes.dark.primary,attrs:{align:"center"}},[e(i["a"],{attrs:{cols:"8"}},[e("h6",{staticClass:"overline"},[t._v("\n                  Email "+t._s(n+1)+"\n                ")])]),e(i["a"],{staticClass:"text-right",attrs:{cols:"4"}},[e(s["a"],{attrs:{icon:""},on:{click:function(){return t.removeEmail(n)}}},[e(r["a"],[t._v("mdi-delete")])],1)],1),e(i["a"],{staticClass:"py-0",attrs:{cols:"12"}},[e(m["a"],{attrs:{label:"Name"},model:{value:a.name,callback:function(e){t.$set(a,"name",e)},expression:"email.name"}})],1),e(i["a"],{staticClass:"py-0",attrs:{cols:"12"}},[e(m["a"],{attrs:{rules:t.emailRules,label:"Email"},model:{value:a.email,callback:function(e){t.$set(a,"email",e)},expression:"email.email"}})],1)],1)]})),e(o["a"],{staticClass:"my-4 mx-0"},[e(s["a"],{staticClass:"mr-3",attrs:{color:"primary",block:""},on:{click:t.addEmail}},[e(r["a"],{staticClass:"pr-3"},[t._v("\n                mdi-plus\n              ")]),t._v("Add Email Address\n            ")],1)],1),e("v-form-base",{attrs:{model:t.mail,col:{cols:12},schema:t.mailSchema},on:{change:t.change}})],2)],1)],1),t.html?e(i["a"],{staticClass:"text-center",attrs:{cols:"12",md:"8"}},[e("iframe",{staticStyle:{"min-width":"560px"},attrs:{scrolling:"no",frameBorder:"0",height:"900",srcdoc:t.html,no:""}})]):t._e()],1),e("form-dialog",{ref:"dialog",attrs:{title:"Edit Settings",schema:t.settingsSchema,item:t.settings},on:{submit:t.submitSettings}}),e("yes-no-dialog",{ref:"yesno",on:{yes:t.currentSend}})],1)}),u=[],h=a("c1df"),p=a.n(h),f=a("cfc7"),g=a("2a69"),b=a.n(g),y=a("283a"),v={components:{FormDialog:f["a"],VFormBase:b.a,YesNoDialog:y["a"]},data:function(){return{valid:!0,settings:{},dialog:!1,loadingSettings:!1,sendingMail:!1,mail:{},emails:[{}],html:null,message:null,currentSend:function(){},emailRules:[function(t){return!!t||"Email is required"},function(t){return/.+@.+/.test(t)||"E-mail must be valid"}],mailSchema:{subject:{type:"text",label:"Subject"},greeting:{type:"text",label:"Greeting"},text:{type:"text",label:"Text"},button_text:{type:"text",label:"Button Text"},button_url:{type:"text",label:"Button URL"},bye:{type:"text",label:"Bye"},person:{type:"text",label:"Person"}},settingsSchema:{host:{type:"text",label:"Host"},port:{type:"number",label:"Port"},email:{type:"email",label:"Email"},password:{type:"password",appendIcon:"mdi-eye",label:"Password"},fromEmail:{type:"email",label:"From Email"},fromName:{type:"text",label:"From Name"},html:{type:"text",label:"HTML"}}}},computed:{site:function(){return this.$store.state.site},user:function(){return this.$store.state.user}},mounted:function(){this.mail={person:this.user.name,greeting:"Dear {{name}}",text:"This is the text of an email that will be send to {{email}} on {{date}}.",bye:"Best regards"},this.getSettings()},methods:{moment:p.a,addEmail:function(){this.emails.push({})},removeEmail:function(t){this.emails.splice(t,1)},editSettings:function(){this.$refs.dialog.open()},getSettings:function(){var t=this;this.site&&(this.loadingSettings=!0,this.api.get("mail/settings/"+this.site).then((function(e){var a=e.data;a&&(t.settings=a,t.setHTML()),t.loadingSettings=!1}),(function(e){t.loadingSettings=!1,t.error=e})))},change:function(){this.setHTML()},setHTML:function(){if(this.settings.html){var t=this.settings.html;if(t=t.replaceAll("{{data}}",""),t=null!=this.mail.button_text?t.replaceAll("{{button}}",'<a href="'+this.mail.button_url+'" id="ctl00_lnkArticle" target="IEXAds" class="articlebutton">'+this.mail.button_text+"</a><br /><br />"):t.replaceAll("{{button}}",""),t=t.replaceAll("{{text}}",this.mail.text),t=t.replaceAll("{{greeting}}",this.mail.greeting),t=t.replaceAll("{{bye}}",this.mail.bye),t=t.replaceAll("{{person}}",this.mail.person),t=t.replaceAll("{{title}}",this.mail.subject),t=t.replaceAll("{{date}}",this.moment().format("LL")),this.emails.length>0){var e=this.emails[0];t=t.replaceAll("{{name}}",e.name),t=t.replaceAll("{{email}}",e.email)}this.html=t}},submitSettings:function(t){var e=this,a=t.item;a.siteId=this.site,this.settings&&this.api.post("mail/settings",a).then((function(s){e.settings=a,t.done()}),(function(a){e.error=a,t.done()}))},sendMail:function(){var t=this;this.$refs.form.validate()&&(this.currentSend=function(e){return t.send(e)},this.$refs.yesno.open("Send mail: ".concat(this.mail.subject),"Are you sure you want to send this mail to ".concat(this.emails.length," recipients?")))},send:function(t){var e=this,a={emails:this.emails,mailBody:this.mail};this.api.post("mail/send/"+this.site,a).then((function(a){e.message=a.data,t()}),(function(a){e.error=a,t()}))}}},x=v,S=a("2877"),_=Object(S["a"])(x,d,u,!1,null,null,null);e["default"]=_.exports},a523:function(t,e,a){"use strict";a("20f6"),a("4b85");var s=a("2b0e");function i(t){return s["default"].extend({name:"v-"+t,functional:!0,props:{id:String,tag:{type:String,default:"div"}},render(e,{props:a,data:s,children:i}){s.staticClass=`${t} ${s.staticClass||""}`.trim();const{attrs:n}=s;if(n){s.attrs={};const t=Object.keys(n).filter(t=>{if("slot"===t)return!1;const e=n[t];return t.startsWith("data-")?(s.attrs[t]=e,!1):e||"string"===typeof e});t.length&&(s.staticClass+=" "+t.join(" "))}return a.id&&(s.domProps=s.domProps||{},s.domProps.id=a.id),e(a.tag,s,i)}})}var n=a("d9f7");e["a"]=i("container").extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render(t,{props:e,data:a,children:s}){let i;const{attrs:l}=a;return l&&(a.attrs={},i=Object.keys(l).filter(t=>{if("slot"===t)return!1;const e=l[t];return t.startsWith("data-")?(a.attrs[t]=e,!1):e||"string"===typeof e})),e.id&&(a.domProps=a.domProps||{},a.domProps.id=e.id),t(e.tag,Object(n["a"])(a,{staticClass:"container",class:Array({"container--fluid":e.fluid}).concat(i||[])}),s)}})}}]);
//# sourceMappingURL=chunk-219d5a63.24cfa213.js.map