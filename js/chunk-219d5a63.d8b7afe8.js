(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-219d5a63"],{3141:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{attrs:{fluid:""}},[a("v-row",{attrs:{justify:"center"}},[a("v-col",{attrs:{cols:"12",md:"4"}},[a("material-card",{staticClass:"v-card-profile",attrs:{loading:t.loadingSettings,color:"primary"},scopedSlots:t._u([{key:"header",fn:function(){return[a("div",{staticClass:"pa-3"},[a("h4",{staticClass:"title font-weight-light"},[t._v("\n              Mail\n            ")])]),a("v-spacer"),t.isBetaCore(t.user)?a("v-btn",{staticClass:"mr-3",attrs:{color:"secondary"},on:{click:t.editSettings}},[a("v-icon",{staticClass:"pr-3"},[t._v("\n              mdi-cog\n            ")]),t._v("Edit Settings\n          ")],1):t._e()]},proxy:!0},{key:"actions",fn:function(){return[a("v-spacer"),a("v-btn",{attrs:{color:"primary"},on:{click:t.sendMail}},[t._v("\n            Send Mail\n          ")])]},proxy:!0}])},[!t.loadingSettings&&!t.settings.host||t.message?a("material-notification",{staticClass:"mb-3",attrs:{color:t.message?"success":"error",icon:"mdi-information-outline"}},[t._v("\n          "+t._s(t.message?t.message:"No mail settings have been set for this site. Contact BetaCore to use mail.")+"\n        ")]):t._e(),a("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[t._l(t.emails,(function(e,i){return[a("v-row",{key:i,staticClass:"mb-2 mx-0",style:"border: 1px solid; border-color: "+t.$vuetify.theme.themes.dark.primary,attrs:{align:"center"}},[a("v-col",{attrs:{cols:"8"}},[a("h6",{staticClass:"overline"},[t._v("\n                  Email "+t._s(i+1)+"\n                ")])]),a("v-col",{staticClass:"text-right",attrs:{cols:"4"}},[a("v-btn",{attrs:{icon:""},on:{click:function(){return t.removeEmail(i)}}},[a("v-icon",[t._v("mdi-delete")])],1)],1),a("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[a("v-text-field",{attrs:{label:"Name"},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"email.name"}})],1),a("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[a("v-text-field",{attrs:{rules:t.emailRules,label:"Email"},model:{value:e.email,callback:function(a){t.$set(e,"email",a)},expression:"email.email"}})],1)],1)]})),a("v-row",{staticClass:"my-4 mx-0"},[a("v-btn",{staticClass:"mr-3",attrs:{color:"primary",block:""},on:{click:t.addEmail}},[a("v-icon",{staticClass:"pr-3"},[t._v("\n                mdi-plus\n              ")]),t._v("Add Email Address\n            ")],1)],1),a("v-form-base",{attrs:{model:t.mail,col:{cols:12},schema:t.mailSchema},on:{change:t.change}})],2)],1)],1),t.html?a("v-col",{staticClass:"text-center",attrs:{cols:"12",md:"8"}},[a("iframe",{staticStyle:{"min-width":"560px"},attrs:{scrolling:"no",frameBorder:"0",height:"900",srcdoc:t.html,no:""}})]):t._e()],1),a("form-dialog",{ref:"dialog",attrs:{title:"Edit Settings",schema:t.settingsSchema,item:t.settings},on:{submit:t.submitSettings}}),a("yes-no-dialog",{ref:"yesno",on:{yes:t.currentSend}})],1)},s=[],n=(a("7f7f"),a("c1df")),l=a.n(n),r=a("cfc7"),o=a("2a69"),c=a.n(o),m=a("283a"),d={components:{FormDialog:r["a"],VFormBase:c.a,YesNoDialog:m["a"]},data:function(){return{valid:!0,settings:{},dialog:!1,loadingSettings:!1,sendingMail:!1,mail:{},emails:[{}],html:null,message:null,currentSend:function(){},emailRules:[function(t){return!!t||"Email is required"},function(t){return/.+@.+/.test(t)||"E-mail must be valid"}],mailSchema:{subject:{type:"text",label:"Subject"},greeting:{type:"text",label:"Greeting"},text:{type:"text",label:"Text"},button_text:{type:"text",label:"Button Text"},button_url:{type:"text",label:"Button URL"},bye:{type:"text",label:"Bye"},person:{type:"text",label:"Person"}},settingsSchema:{host:{type:"text",label:"Host"},port:{type:"number",label:"Port"},email:{type:"email",label:"Email"},password:{type:"password",appendIcon:"mdi-eye",label:"Password"},fromEmail:{type:"email",label:"From Email"},fromName:{type:"text",label:"From Name"},html:{type:"text",label:"HTML"}}}},computed:{site:function(){return this.$store.state.site},user:function(){return this.$store.state.user}},mounted:function(){this.mail={person:this.user.name,greeting:"Dear {{name}}",text:"This is the text of an email that will be send to {{email}} on {{date}}.",bye:"Best regards"},this.getSettings()},methods:{moment:l.a,addEmail:function(){this.emails.push({})},removeEmail:function(t){this.emails.splice(t,1)},editSettings:function(){this.$refs.dialog.open()},getSettings:function(){var t=this;this.site&&(this.loadingSettings=!0,this.api.get("mail/settings/"+this.site).then((function(e){var a=e.data;a&&(t.settings=a,t.setHTML()),t.loadingSettings=!1}),(function(e){t.loadingSettings=!1,t.error=e})))},change:function(){this.setHTML()},setHTML:function(){if(this.settings.html){var t=this.settings.html;if(t=t.replaceAll("{{data}}",""),t=null!=this.mail.button_text?t.replaceAll("{{button}}",'<a href="'+this.mail.button_url+'" id="ctl00_lnkArticle" target="IEXAds" class="articlebutton">'+this.mail.button_text+"</a><br /><br />"):t.replaceAll("{{button}}",""),t=t.replaceAll("{{text}}",this.mail.text),t=t.replaceAll("{{greeting}}",this.mail.greeting),t=t.replaceAll("{{bye}}",this.mail.bye),t=t.replaceAll("{{person}}",this.mail.person),t=t.replaceAll("{{title}}",this.mail.subject),t=t.replaceAll("{{date}}",this.moment().format("LL")),this.emails.length>0){var e=this.emails[0];t=t.replaceAll("{{name}}",e.name),t=t.replaceAll("{{email}}",e.email)}this.html=t}},submitSettings:function(t){var e=this,a=t.item;a.siteId=this.site,this.settings&&this.api.post("mail/settings",a).then((function(i){e.settings=a,t.done()}),(function(a){e.error=a,t.done()}))},sendMail:function(){var t=this;this.$refs.form.validate()&&(this.currentSend=function(e){return t.send(e)},this.$refs.yesno.open("Send mail: ".concat(this.mail.subject),"Are you sure you want to send this mail to ".concat(this.emails.length," recipients?")))},send:function(t){var e=this,a={emails:this.emails,mailBody:this.mail};this.api.post("mail/send/"+this.site,a).then((function(a){e.message=a.data,t()}),(function(a){e.error=a,t()}))}}},u=d,h=a("2877"),p=a("6544"),f=a.n(p),g=a("8336"),v=a("62ad"),b=a("a523"),y=a("4bd4"),x=a("132d"),S=a("0fd9"),C=a("2fa4"),_=a("8654"),k=Object(h["a"])(u,i,s,!1,null,null,null);e["default"]=k.exports;f()(k,{VBtn:g["a"],VCol:v["a"],VContainer:b["a"],VForm:y["a"],VIcon:x["a"],VRow:S["a"],VSpacer:C["a"],VTextField:_["a"]})},a523:function(t,e,a){"use strict";a("20f6"),a("4b85");var i=a("2b0e");function s(t){return i["default"].extend({name:"v-"+t,functional:!0,props:{id:String,tag:{type:String,default:"div"}},render(e,{props:a,data:i,children:s}){i.staticClass=`${t} ${i.staticClass||""}`.trim();const{attrs:n}=i;if(n){i.attrs={};const t=Object.keys(n).filter(t=>{if("slot"===t)return!1;const e=n[t];return t.startsWith("data-")?(i.attrs[t]=e,!1):e||"string"===typeof e});t.length&&(i.staticClass+=" "+t.join(" "))}return a.id&&(i.domProps=i.domProps||{},i.domProps.id=a.id),e(a.tag,i,s)}})}var n=a("d9f7");e["a"]=s("container").extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render(t,{props:e,data:a,children:i}){let s;const{attrs:l}=a;return l&&(a.attrs={},s=Object.keys(l).filter(t=>{if("slot"===t)return!1;const e=l[t];return t.startsWith("data-")?(a.attrs[t]=e,!1):e||"string"===typeof e})),e.id&&(a.domProps=a.domProps||{},a.domProps.id=e.id),t(e.tag,Object(n["a"])(a,{staticClass:"container",class:Array({"container--fluid":e.fluid}).concat(s||[])}),i)}})}}]);
//# sourceMappingURL=chunk-219d5a63.d8b7afe8.js.map