(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-447babe4"],{"283a":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-dialog",{attrs:{width:"500"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[i("material-card",{attrs:{title:t.title},scopedSlots:t._u([{key:"actions",fn:function(){return[i("v-spacer"),i("v-btn",{attrs:{color:"primary",loading:t.loading},on:{click:t.yes}},[t._v("\n        Yes\n      ")]),i("v-btn",{attrs:{color:"primary",text:""},on:{click:function(e){t.dialog=!1}}},[t._v("\n        No\n      ")])]},proxy:!0}])},[t._v("\n    "+t._s(t.text)+"\n    ")])],1)},s=[],n={data:function(){return{dialog:!1,loading:!1,title:null,text:null}},methods:{open:function(t,e,i){this.title=t,this.text=e,this.dialog=!0},yes:function(){var t=this;this.loading=!0,this.$emit("yes",(function(){t.loading=!1,t.dialog=!1}))}}},l=n,r=i("2877"),o=i("6544"),c=i.n(o),m=i("8336"),d=i("169a"),u=i("2fa4"),f=Object(r["a"])(l,a,s,!1,null,null,null);e["a"]=f.exports;c()(f,{VBtn:m["a"],VDialog:d["a"],VSpacer:u["a"]})},3141:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{attrs:{fluid:""}},[i("v-row",{attrs:{justify:"center"}},[i("v-col",{attrs:{cols:"12",md:"4"}},[i("material-card",{staticClass:"v-card-profile",attrs:{loading:t.loadingSettings,color:"primary"},scopedSlots:t._u([{key:"header",fn:function(){return[i("div",{staticClass:"pa-3"},[i("h4",{staticClass:"title font-weight-light"},[t._v("\n              Mail\n            ")])]),i("v-spacer"),t.isBetaCore(t.user)?i("v-btn",{staticClass:"mr-3",attrs:{color:"secondary"},on:{click:t.editSettings}},[i("v-icon",{staticClass:"pr-3"},[t._v("\n              mdi-cog\n            ")]),t._v("Edit Settings\n          ")],1):t._e()]},proxy:!0},{key:"actions",fn:function(){return[i("v-spacer"),i("v-btn",{attrs:{color:"primary"},on:{click:t.sendMail}},[t._v("\n            Send Mail\n          ")])]},proxy:!0}])},[!t.loadingSettings&&!t.settings.host||t.message?i("material-notification",{staticClass:"mb-3",attrs:{color:t.message?"success":"error",icon:"mdi-information-outline"}},[t._v("\n          "+t._s(t.message?t.message:"No mail settings have been set for this site. Contact BetaCore to use mail.")+"\n        ")]):t._e(),i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[t._l(t.emails,(function(e,a){return[i("v-row",{key:a,staticClass:"mb-2 mx-0",style:"border: 1px solid; border-color: "+t.$vuetify.theme.themes.dark.primary,attrs:{align:"center"}},[i("v-col",{attrs:{cols:"8"}},[i("h6",{staticClass:"overline"},[t._v("\n                  Email "+t._s(a+1)+"\n                ")])]),i("v-col",{staticClass:"text-right",attrs:{cols:"4"}},[i("v-btn",{attrs:{icon:""},on:{click:function(){return t.removeEmail(a)}}},[i("v-icon",[t._v("mdi-delete")])],1)],1),i("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[i("v-text-field",{attrs:{label:"Name"},model:{value:e.name,callback:function(i){t.$set(e,"name",i)},expression:"email.name"}})],1),i("v-col",{staticClass:"py-0",attrs:{cols:"12"}},[i("v-text-field",{attrs:{rules:t.emailRules,label:"Email"},model:{value:e.email,callback:function(i){t.$set(e,"email",i)},expression:"email.email"}})],1)],1)]})),i("v-row",{staticClass:"my-4 mx-0"},[i("v-btn",{staticClass:"mr-3",attrs:{color:"primary",block:""},on:{click:t.addEmail}},[i("v-icon",{staticClass:"pr-3"},[t._v("\n                mdi-plus\n              ")]),t._v("Add Email Address\n            ")],1)],1),i("v-form-base",{attrs:{model:t.mail,col:{cols:12},schema:t.mailSchema},on:{change:t.change}})],2)],1)],1),t.html?i("v-col",{staticClass:"text-center",attrs:{cols:"12",md:"8"}},[i("iframe",{staticStyle:{"min-width":"560px"},attrs:{scrolling:"no",frameBorder:"0",height:"900",srcdoc:t.html,no:""}})]):t._e()],1),i("form-dialog",{ref:"dialog",attrs:{title:"Edit Settings",schema:t.settingsSchema,item:t.settings},on:{submit:t.submitSettings}}),i("yes-no-dialog",{ref:"yesno",on:{yes:t.currentSend}})],1)},s=[],n=(i("7f7f"),i("c1df")),l=i.n(n),r=i("cfc7"),o=i("2a69"),c=i.n(o),m=i("283a"),d={components:{FormDialog:r["a"],VFormBase:c.a,YesNoDialog:m["a"]},data:function(){return{valid:!0,settings:{},dialog:!1,loadingSettings:!1,sendingMail:!1,mail:{},emails:[{}],html:null,message:null,currentSend:function(){},emailRules:[function(t){return!!t||"Email is required"},function(t){return/.+@.+/.test(t)||"E-mail must be valid"}],mailSchema:{subject:{type:"text",label:"Subject"},greeting:{type:"text",label:"Greeting"},text:{type:"text",label:"Text"},button_text:{type:"text",label:"Button Text"},button_url:{type:"text",label:"Button URL"},bye:{type:"text",label:"Bye"},person:{type:"text",label:"Person"}},settingsSchema:{host:{type:"text",label:"Host"},port:{type:"number",label:"Port"},email:{type:"email",label:"Email"},password:{type:"password",appendIcon:"mdi-eye",label:"Password"},fromEmail:{type:"email",label:"From Email"},fromName:{type:"text",label:"From Name"},html:{type:"text",label:"HTML"}}}},computed:{site:function(){return this.$store.state.site},user:function(){return this.$store.state.user}},mounted:function(){this.mail={person:this.user.name,greeting:"Dear {{name}}",text:"This is the text of an email that will be send to {{email}} on {{date}}.",bye:"Best regards"},this.getSettings()},methods:{moment:l.a,addEmail:function(){this.emails.push({})},removeEmail:function(t){this.emails.splice(t,1)},editSettings:function(){this.$refs.dialog.open()},getSettings:function(){var t=this;this.site&&(this.loadingSettings=!0,this.api.get("mail/settings/"+this.site).then((function(e){var i=e.data;i&&(t.settings=i,t.setHTML()),t.loadingSettings=!1}),(function(e){t.loadingSettings=!1,t.error=e})))},change:function(){this.setHTML()},setHTML:function(){if(this.settings.html){var t=this.settings.html;if(t=t.replaceAll("{{data}}",""),t=null!=this.mail.button_text?t.replaceAll("{{button}}",'<a href="'+this.mail.button_url+'" id="ctl00_lnkArticle" target="IEXAds" class="articlebutton">'+this.mail.button_text+"</a><br /><br />"):t.replaceAll("{{button}}",""),t=t.replaceAll("{{text}}",this.mail.text),t=t.replaceAll("{{greeting}}",this.mail.greeting),t=t.replaceAll("{{bye}}",this.mail.bye),t=t.replaceAll("{{person}}",this.mail.person),t=t.replaceAll("{{title}}",this.mail.subject),t=t.replaceAll("{{date}}",this.moment().format("LL")),this.emails.length>0){var e=this.emails[0];t=t.replaceAll("{{name}}",e.name),t=t.replaceAll("{{email}}",e.email)}this.html=t}},submitSettings:function(t){var e=this,i=t.item;i.siteId=this.site,this.settings&&this.api.post("mail/settings",i).then((function(a){e.settings=i,t.done()}),(function(i){e.error=i,t.done()}))},sendMail:function(){var t=this;this.$refs.form.validate()&&(this.currentSend=function(e){return t.send(e)},this.$refs.yesno.open("Send mail: ".concat(this.mail.subject),"Are you sure you want to send this mail to ".concat(this.emails.length," recipients?")))},send:function(t){var e=this,i={emails:this.emails,mailBody:this.mail};this.api.post("mail/send/"+this.site,i).then((function(i){e.message=i.data,t()}),(function(i){e.error=i,t()}))}}},u=d,f=i("2877"),h=i("6544"),p=i.n(h),g=i("8336"),v=i("62ad"),b=i("a523"),y=i("4bd4"),x=i("132d"),S=i("0fd9"),_=i("2fa4"),C=i("8654"),k=Object(f["a"])(u,a,s,!1,null,null,null);e["default"]=k.exports;p()(k,{VBtn:g["a"],VCol:v["a"],VContainer:b["a"],VForm:y["a"],VIcon:x["a"],VRow:S["a"],VSpacer:_["a"],VTextField:C["a"]})},a523:function(t,e,i){"use strict";i("20f6"),i("4b85");var a=i("2b0e");function s(t){return a["default"].extend({name:"v-"+t,functional:!0,props:{id:String,tag:{type:String,default:"div"}},render(e,{props:i,data:a,children:s}){a.staticClass=`${t} ${a.staticClass||""}`.trim();const{attrs:n}=a;if(n){a.attrs={};const t=Object.keys(n).filter(t=>{if("slot"===t)return!1;const e=n[t];return t.startsWith("data-")?(a.attrs[t]=e,!1):e||"string"===typeof e});t.length&&(a.staticClass+=" "+t.join(" "))}return i.id&&(a.domProps=a.domProps||{},a.domProps.id=i.id),e(i.tag,a,s)}})}var n=i("d9f7");e["a"]=s("container").extend({name:"v-container",functional:!0,props:{id:String,tag:{type:String,default:"div"},fluid:{type:Boolean,default:!1}},render(t,{props:e,data:i,children:a}){let s;const{attrs:l}=i;return l&&(i.attrs={},s=Object.keys(l).filter(t=>{if("slot"===t)return!1;const e=l[t];return t.startsWith("data-")?(i.attrs[t]=e,!1):e||"string"===typeof e})),e.id&&(i.domProps=i.domProps||{},i.domProps.id=e.id),t(e.tag,Object(n["a"])(i,{staticClass:"container",class:Array({"container--fluid":e.fluid}).concat(s||[])}),a)}})}}]);
//# sourceMappingURL=chunk-447babe4.5fcf5d4c.js.map